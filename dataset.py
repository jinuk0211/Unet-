# -*- coding: utf-8 -*-
"""dataset

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1d9mH6jyLZM6zzwj26t16jOsPotRpVM_1
"""

import torch
from PIL import Image
from torch.utils.data import Dataset
import numpy as np
import os

class Dataset(Dataset):
  def __init__(self,image_dir,mask_dir,transform=None):

    self.image_dir = image_dir /image_dir
    self.mask_dir = mask_dir
    self.transform = transform
    self.images = os.listdir(image_dir) #image 디렉토리 안 모든파일 리스트

  def __len__(self):
    return len(self.images)

  def __getitem__(self,idx):
    imgpath = os.path.join(self.image_dir,self.images[idx])
    # /image_dir/images1
    maskpath = os.path.join(self.mask_dir,self.images[idx].replace(".jpg",'_mask.gif'))
    image = np.array(Image.open(imgpath).convert("RGB")) # image PIL package module
    mask = np.array(Image.open(maskpath).convert('L'),dtype=np.float32) #회색모드 L = luminance
    mask[mask==255.0] =1.0
    # 흰색 즉 배경 RGB 값 255.0 를 1로 바꿈 변경후 0과 1로 이뤄진 이진 마스크 image가 됨

    if self.transform is not None:
      augmentations = self.transform(image=image,mask=mask)
      image = augmentations['image']
      mask = augmentations['mask']